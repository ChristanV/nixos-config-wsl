version: 0.1
cli:
  version: 1.22.2

plugins:
  sources:
    - id: trunk
      ref: v1.6.1
      uri: https://github.com/trunk-io/plugins

lint:
  enabled:
    # Security scanning (equivalent to gitleaks)
    - gitleaks@8.21.2
    
    # Built-in formatters and linters (equivalent to pre-commit-hooks)
    - trufflehog@3.81.9  # Additional security scanning
    - checkov@3.2.254    # Infrastructure security
    
    # YAML checking
    - yamllint@1.35.1
    
    # Nix tooling
    
    - deadnix@SYSTEM  
    - statix@SYSTEM

  definitions:
    - name: nixfmt
      files: [nix]
      commands:
        - output: rewrite
          run: nixfmt ${target}
          success_codes: [0]
    - name: deadnix
      files: [nix]
      commands:
        - output: sarif
          success_codes: [0, 1]
          run: deadnix --output-format json ${target}
    - name: statix
      files: [nix]
      commands:
        - output: sarif
          success_codes: [0, 1]
          run: statix check --format json ${target}
    - name: nix-flake-check
      files: [nix]
      commands:
        - output: rewrite
          formatter: true
          run: nix flake check
          success_codes: [0]
      suggest_if: config_present
      direct_configs:
        - flake.nix
      known_good_version: system
      environment:
        - name: PATH
          list: ["${workspace}"]

actions:
  enabled:
    - trunk-announce
    - trunk-check-pre-push
    - trunk-fmt-pre-commit
    - trunk-upgrade-available

# Custom actions for Nix flake check
runtimes:
  enabled:
    - node@18.12.1
    - python@3.10.8
    - rust@1.73.0

